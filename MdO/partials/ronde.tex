\begin{OM}{SystemeRonde}{Système Ronde}

\begin{OMOperation}{cdeVisualiserDrone()}{Superviser Ronde}{}
Messages :
    ecranSupervision::{visualiserDrones}
    \begin{OMPre}
    \end{OMPre}
    \begin{OMPost}
self.ecranSupervision^visualiserDrones()
\end{OMPost}
\end{OMOperation}

\begin{OMOperation}{cdeVisualiserTournées()}{Superviser Ronde}{}
Messages :
ecranSupervision::{visualiserTournees}
\begin{OMPre}
\end{OMPre}
\begin{OMPost}
self.ecranSupervision^visualiserTournees()
\end{OMPost}
\end{OMOperation}

\begin{OMOperation}{envoyerCommande(cde : Commande)}{Livrer une tournée}{}
Messages :
BD::{ajouterCommande,calculerTournées}
\begin{OMPre}
\end{OMPre}
\begin{OMPost}
        self.bd^ajouterCommande(cde)
self.bd^calculerTournees()
\end{OMPost}
\end{OMOperation}

\begin{OMOperation}{annulerCommade(lst : ListeCommande)}{Livrer une tournée}{}
Messages :
BD::{supprimerCommande,calculerTournees,}
\begin{OMPre}
\end{OMPre}
\begin{OMPost}
self.bd^supprimerCommande(lst)
self.bd^calculerTournees()
\end{OMPost}
\end{OMOperation}

\begin{OMOperation}{notifierExpiration(t : Tournee)}{Livrer une tournée}{}
Messages :
drone::{envoyerDrone}
BD::{supprimerCommande}
boiteMail::{envoyerMessage}
\begin{OMPre}
\end{OMPre}
\begin{OMPost}
self.bd^supprimerCommande(sender.tournee.lstCommande)
sender.tournee.drone^envoyerDrone()
self.boiteMail^envoyerMessage(sender.tournee.drone.id,DEPART_DRONE)
sender.tournee.drone.oclInState(Livraison)
\end{OMPost}
\end{OMOperation}

\begin{OMOperation}{signalerPosition(p : Position)}{Livrer une tournée}{}
Messages :
ecranSupervision::{visualiserDrone}
BD::{majPositionDrone}
\begin{OMPre}
\end{OMPre}
\begin{OMPost}
self.bd^majPositionDrone(sender.drone.id, p)
self.ecranSupervision^visualiserDrone()
\end{OMPost}
\end{OMOperation}

\begin{OMOperation}{signalerLivraison(cde : Commande)}{Livrer une tournée}{}
Messages :
BD::{supprimerCommande}
\begin{OMPre}
\end{OMPre}
\begin{OMPost}
self.bd^supprimerCommande(cde)
\end{OMPost}
\end{OMOperation}

\begin{OMOperation}{signalerAnormalie(a : Anormalie)}{Livrer une tournée}{}
Messages :
BD::{majEtatDrone}
boiteMail::{envoyerMessage}
\begin{OMPre}
\end{OMPre}
\begin{OMPost}
sender.drone.oclInState(Erreur)
self.bd.majEtatDrone(sender.drone.id, a)
self.boiteMail^envoyerMessage(sender.drone.id, a)
\end{OMPost}
\end{OMOperation}

\begin{OMOperation}{signalerRetour()}{Livrer une tournée}{}
Messages :
BD::{majEtatDrone}
boiteMail::{envoyerMessage}
\begin{OMPre}
\end{OMPre}
\begin{OMPost}
        self.bd.majEtatDrone(sender.drone.id,PRET)
        self.boiteMail^envoyerMessage(sender.drone.id,RETOUR)
        sender.drone.oclInState(Inactif)
    \end{OMPost}
\end{OMOperation}

\begin{OMOperation}{estOperationnel()}{Livrer une tournée}{}
Messages :
BD::{majEtatDrone}
DronePhysique::{envoyerDrone}
\begin{OMPre}
\end{OMPre}
\begin{OMPost}
        self.bd.majEtatDrone(idDrone,BON_ETATt)
        if sender.drone.Tournee.lstCommandes is null
                sender.drone.oclInState(Inactif)
                self.bd.majEtatDrone(idDrone,Pret)
        else
                sender.drone.oclInState(Livraison)
                self.sender^envoyerDrone()
            \end{OMPost}
\end{OMOperation}
\end{OM}
